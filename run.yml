---
- name: Debug all variables/facts
  hosts: localhost
  gather_facts: no
  vars:
    my_pass: !vault | 
      $ANSIBLE_VAULT;1.1;AES256
      37343363383139316262653431336638366632383030633135383761353334636562373130616132
      3936383230656263623436346437313264383139636134310a393636386530396663356633323039
      38313038363035666364323737623762363233313437393035376236656637616539303830616632
      3736616661373031320a653164323333363834643862303734316565633830613361666532626664
      3965
  tasks: 
    - name: Display hostvars
      debug: 
        msg: "{{ hostvars }}"
        verbosity: 4
    - name: Display ansible_host
      debug: 
        msg: "{{ hostvars['203.78.103.80'].ansible_host }}"
        verbosity: 4
    - name: Display ansible_port
      debug: 
        msg: "{{ hostvars['203.78.103.80'].ansible_port }}"
        verbosity: 4
    - name: Display ansible_user
      debug: 
        msg: "{{ hostvars['203.78.103.80'].ansible_user }}"
        verbosity: 4
    - name: Display hostvars ansible_password
      debug: 
        msg: "{{ hostvars['203.78.103.80'].ansible_password }}"
        verbosity: 4
    - name: Display my_pass
      debug: 
        msg: "{{ my_pass }}"
        verbosity: 4
    - name: Display decrypt my_pass
      shell: "echo '{{ my_pass }}'"
      become: true
      register: debug_echo_text
      
    - debug: msg="Output debug_echo_text={{ debug_echo_text.stdout }}"
- name: EzyAdmin test server connection
  hosts: all
  gather_facts: no
  tasks:     
    - name: Hostname a variable
      debug: var=inventory_hostname

    - name: Check ansible_os_family
      debug:
        msg: "ansible_os_family={{ ansible_os_family }}"

    - block:
        ## Check sudo command
        - name: Test command for linux OS
          #command: whoami
          shell: "{{ item }}"
          #shell: whoami
          become: true
          register: whoamiout
          changed_when: false
          with_items:
            - "whoami"
          #  #- "/usr/bin/whoami"
          failed_when: "'error' in whoamiout.stderr"
        #- debug: msg="Output whoami={{ whoamiout.stdout }}"
      when: (ansible_os_family == "RedHat") or (ansible_os_family == "Redhat") or (ansible_os_family == "CentOS") or (ansible_os_family == "Debian")

    - block:
        - name: Test command for windows OS
          win_command: whoami
          #become: true
          register: whoamiout
          changed_when: false
          #when: ansible_os_family == "Windows"
          failed_when: "'error' in whoamiout.stderr"
        #- debug: msg="Output whoami={{ whoamiout.stdout }}"
      when: ansible_os_family == "Windows"
